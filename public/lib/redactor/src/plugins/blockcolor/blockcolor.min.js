Redactor.add("plugin","blockcolor",{translations:{en:{blockcolor:{color:"Color"}}},defaults:{input:!0,icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6C11.4696 6 10.9609 6.21071 10.5858 6.58579C10.2107 6.96086 10 7.46957 10 8V10H14V8C14 7.46957 13.7893 6.96086 13.4142 6.58579C13.0391 6.21071 12.5304 6 12 6ZM16 8C16 6.93913 15.5786 5.92172 14.8284 5.17157C14.0783 4.42143 13.0609 4 12 4C10.9391 4 9.92172 4.42143 9.17157 5.17157C8.42143 5.92172 8 6.93913 8 8V15C8 15.5523 8.44772 16 9 16C9.55228 16 10 15.5523 10 15V12H14V15C14 15.5523 14.4477 16 15 16C15.5523 16 16 15.5523 16 15V8ZM4 19C4 18.4477 4.44772 18 5 18H19C19.5523 18 20 18.4477 20 19C20 19.5523 19.5523 20 19 20H5C4.44772 20 4 19.5523 4 19Z"/></svg>'},init(){this.colors=this.opts.is("blockcolor.colors")?this.opts.get("blockcolor.colors"):this.opts.get("colors")},start(){var o={icon:this.opts.get("blockcolor.icon"),command:"blockcolor.popup",title:"## blockcolor.color ##",position:{before:["duplicate","trash"]},blocks:{all:!0,except:["line","noneditable"]}};this.app.control.add("blockcolor",o)},popup(t,e){var l=this._getInstance();if(l){var s=this.app.create("utils"),l=l.getBlock();let o=s.cssToObject(l.attr("style"));s=this.app.broadcast("blockcolor.get");s.has("style")&&(o=s.get("style"));l=this.app.create("colorpicker").create({colors:this.colors,input:this.opts.get("blockcolor.input"),style:o,name:"color",instant:!0,set:"blockcolor.set",remove:"blockcolor.remove"});this.app.dropdown.create("blockcolor",{html:l}),this.app.dropdown.open(t,e)}},set(o,t){t||(this.app.dropdown.close(),this.app.editor.restore()),this.app.broadcast("blockcolor.set",{style:o.style}).isStopped()||(t=this._getInstance())&&t.setStyle(o.style)},remove(){this.app.dropdown.close(),this.app.editor.restore();var o=this._getInstance();o&&o.setStyle({color:""})},_getInstance(){let o=this.app.block.get();return o=o||this.app.blocks.get({first:!0,instances:!0,except:["line","noneditable"]})}});