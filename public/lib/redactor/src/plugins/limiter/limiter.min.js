Redactor.add("plugin","limiter",{defaults:{limit:!1},subscribe:{"editor.before.paste":function(t){this.opts.is("limiter.limit")&&this._handlePaste(t)},"editor.keydown":function(t){this.opts.is("limiter.limit")&&this._isLimitReached(t.get("e"))&&t.stop()},"editor.keyup":function(t){this._checkLength()},"editor.insert, editor.set, editor.empty":function(){this._checkLength()}},loaded(){this._checkLength()},stop(){this.app.statusbar.remove("limiter")},_showStatusBar(t){this.opts.is("limiter.limit")&&this.app.statusbar.add("limiter",t+"/"+this.opts.get("limiter.limit"))},_handlePaste(t){var e=t.get("html"),e=this._sanitizeHtml(e),i=this._getText();e.length+i.length>=this.opts.get("limiter.limit")&&t.stop()},_isLimitReached(t){var e=t.which,i=t.ctrlKey||t.metaKey,s=this.app.keycodes;return!([s.BACKSPACE,s.DELETE,s.ESC,s.SHIFT].includes(e)||i&&[65,88,82,116].includes(e)||[37,38,39,40].includes(e))&&this._checkLength(t)},_checkLength(t){var e=this._getText();if(this._showStatusBar(e.length),e.length>=this.opts.get("limiter.limit"))return t&&t.preventDefault(),!0},_getText(){var t=this.app.editor.getLayout().html();return this._sanitizeHtml(t)},_sanitizeHtml(t){var e=this.app.create("utils");return t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]*?-->\n?/g,"")).replace(/<\/(.*?)>/gi," ")).replace(/<(.*?)>/gi,"")).replace(/\t/gi,"")).replace(/\n/gi," ")).replace(/\r/gi," ")).replace(/&nbsp;/g,"1")).replace(/\s+/g," ")).trim(),t=e.removeInvisibleChars(t)}});